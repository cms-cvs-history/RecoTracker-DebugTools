process TkVal = 
{
  untracked PSet maxEvents = {untracked int32 input = NEVENT}

  #service = MessageLogger   {
  #	untracked vstring destinations   = { "cout" }
  #     untracked vstring categories     = { "TrackingRegressionTest" }
  #	untracked vstring debugModules   = { "preFilterFirstStepTracks" }
  # 	untracked PSet cout          = { untracked string threshold = "DEBUG" 
  #	untracked PSet INFO          = { untracked int32 limit = 0 }
  #	untracked PSet DEBUG         = { untracked int32 limit = 0 }
  #	untracked PSet TrackingRegressionTest = { untracked int32 limit = 10000000}
  #       }
  #}
  include "FWCore/MessageService/data/MessageLogger.cfi"

  include "Configuration/StandardSequences/data/Reconstruction.cff"
  include "Configuration/StandardSequences/data/MagneticField.cff"
  #include "Configuration/StandardSequences/data/Simulation.cff"
  #include "Configuration/StandardSequences/data/Services.cff" 
  #include "Configuration/StandardSequences/data/RawToDigi.cff"
  #include "Configuration/StandardSequences/data/MixingNoPileUp.cff" 

  ##include "Configuration/StandardSequences/data/FakeConditions.cff"
  ##include "Configuration/StandardSequences/data/FrontierConditions_GlobalTag.cff" 
  ##replace GlobalTag.globaltag = "IDEAL_V2::All" 
  replace GlobalTag.globaltag = "STARTUP_V1::All"

  ### for the validator 
  # Track Associators
  include "SimTracker/TrackAssociation/data/TrackAssociatorByChi2.cfi"
  include "SimTracker/TrackAssociation/data/TrackAssociatorByHits.cfi"

  include "Validation/RecoTrack/data/cuts.cff"
  include "Validation/RecoTrack/data/cutsTPEffic.cfi"
  include "Validation/RecoTrack/data/cutsTPFake.cfi"
  include "Validation/RecoTrack/data/MultiTrackValidator.cff"


  source = PoolSource 
  { 
    untracked vstring fileNames = {'file:input.root'}
  }


  ##############################
  #replace MessageLogger.cout.placeholder = false
  #module pts = PathTimerInserter{}
  #service = PathTimerService{}
  #service = Timing{}
  untracked PSet options = { untracked bool wantSummary = true }
  include "RecoTracker/DebugTools/test/SAMPLE.cff"

  ### merging
  #module mergedTracks = TrackMerger {
  #   VInputTag src = { "firstvtxFilt:","secondvtxFilt:",
  #                     "thirdvtxFilt:","fourthvtxFilt:" }
  #}

  ### track collection filtering
  include "RecoTracker/FinalTrackSelectors/data/selectTighter.cfi"
  #replace cutsRecoTracks.quality = "loose"
  #replace cutsRecoTracks.quality = "tight"
  #replace cutsRecoTracks.quality = "highPurity"

  ### validation
  replace multiTrackValidator.out = "val.SAMPLE.root"	
  replace multiTrackValidator.associators = {"TrackAssociatorByHits"}
  replace multiTrackValidator.label = {generalTracks}
  ##replace multiTrackValidator.label = {cutsRecoTracks}
  ##replace multiTrackValidator.UseAssociators = true

  ###############################


  module out = PoolOutputModule 
  {
    untracked string fileName = 'output.SAMPLE.root'
    untracked vstring outputCommands = 
      {
        "drop *",
        #"keep *_g4SimHits_TrackerHits*_*",
        #"keep SimVertexs_g4SimHits_*_*",
        #"keep SimTracks_g4SimHits_*_*",
        #"keep *_trackingtruthprod_*_*",
        #"keep PixelDigiSimLink*_*_*_*",
        #"keep StripDigiSimLink*_*_*_*",
        #"keep *_siPixelClusters_*_*",
        #"keep *_siStripClusters_*_*",
        #"keep *_cmsTracks_*_*",
        #"keep *_pixelVertices_*_*",
        #"keep recoTracks_pixelTracks_*_*",
        #"keep *_ctfWithMaterialTracks_*_*",
        "keep HLTPerformanceInfo_*_*_*"
      }
  }      

  sequence digi2track =   {
   siPixelDigis,SiStripRawToDigis,
   trackerlocalreco,
   ##globalMixedSeeds,ckfTrackCandidates,ctfWithMaterialTracks,cutsCKF,  # <20X tracking sequence
   ## newTracking ## 20X tracking sequence
   ckftracks, ## >=210pre6 tracking sequence
   cutsTPEffic,cutsTPFake,
   multiTrackValidator
   #,pts
  }


  sequence re_tracking =   {
   siPixelRecHits,siStripMatchedRecHits,
   ##globalMixedSeeds,ckfTrackCandidates,ctfWithMaterialTracks,cutsCKF,  # <20X tracking sequence
   ## newTracking ## 20X tracking sequence
   ckftracks, ## >=210pre6 tracking sequence
   cutsTPEffic,cutsTPFake,
   multiTrackValidator
   #,pts
  }

 
  include "SimGeneral/TrackingAnalysis/data/trackingParticles.cfi"
  include "SimGeneral/MixingModule/data/mixNoPU.cfi"

  sequence only_validation = {
   ##cutsTPEffic,cutsTPFake,
   ##cutsRecoTracks,
   multiTrackValidator
   #pts 
  }
                     
  path p = {
   SEQUENCE	
  }


#  endpath e = 
#  {
#    out
#  }
}
